<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Drag, Drop, Resize â€“ Desktop & HP</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    overflow: hidden;
  }

  #menu {
    width: 100%;
    background: #eee;
    display: flex;
    gap: 10px;
    padding: 10px;
  }

  .elemen {
    width: 60px;
    height: 60px;
    border: 1px solid #999;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
  }

  .elemen img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  #elements-layer {
    width: 100vw;
    height: calc(100vh - 80px);
    background: #fafafa;
    position: relative;
    overflow: hidden;
  }

  .resizable {
    position: absolute;
    border: 2px solid #000;
    border-radius: 10px;
    box-sizing: border-box;
    user-select: none;
    touch-action: none;
  }

  .resizable img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    -webkit-user-drag: none;
    user-select: none;
    touch-action: none;
  }

  .resize-handle {
    width: 20px;
    height: 20px;
    background: #000;
    position: absolute;
    right: -10px;
    bottom: -10px;
    border-radius: 50%;
    cursor: se-resize;
  }

  #petunjuk {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0.3;
    font-size: 20px;
  }
</style>
</head>
<body>

<div id="menu">
  <div class="elemen" id="el1" draggable="true">
    <img src="https://picsum.photos/100?1">
  </div>
  <div class="elemen" id="el2" draggable="true">
    <img src="https://picsum.photos/100?2">
  </div>
  <div class="elemen" id="el3" draggable="true">
    <img src="https://picsum.photos/100?3">
  </div>
</div>

<div id="elements-layer">
  <div id="petunjuk">Tarik elemen ke sini</div>
</div>

<script>
// Mencegah longpress-menu di HP
document.addEventListener("contextmenu", e => e.preventDefault());

// ELEMENTS
const elementsLayer = document.getElementById("elements-layer");
const petunjuk = document.getElementById("petunjuk");

// Touch drag id global
let draggingId = null;

// Desktop dragstart + mobile touch fallback
document.querySelectorAll(".elemen").forEach(el => {
  // Desktop drag
  el.addEventListener("dragstart", (e)=> {
    e.dataTransfer.setData("id", el.id);
  });

  // Mobile touch
  el.addEventListener("touchstart", (e)=> {
    draggingId = el.id;
  });
});

// Spawn element
function spawnElement(id, x, y){
  const draggedEl = document.getElementById(id);
  if (!draggedEl) return;

  petunjuk.style.display = "none";

  const clone = document.createElement("div");
  clone.classList.add("resizable");
  clone.style.left = `${x}px`;
  clone.style.top = `${y}px`;
  clone.style.width = "100px";
  clone.style.height = "100px";

  const img = document.createElement("img");
  img.src = draggedEl.querySelector("img").src;
  clone.appendChild(img);

  const handle = document.createElement("div");
  handle.classList.add("resize-handle");
  clone.appendChild(handle);

  elementsLayer.appendChild(clone);
  makeDraggable(clone);
  makeResizable(clone, handle);
}

// Desktop drop
function handleDrop(e){
  e.preventDefault();
  const id = e.dataTransfer.getData("id");
  if (!id) return;

  const rect = elementsLayer.getBoundingClientRect();
  spawnElement(id, e.clientX - rect.left - 50, e.clientY - rect.top - 50);
}

elementsLayer.addEventListener("dragover", e => e.preventDefault());
elementsLayer.addEventListener("drop", handleDrop);

// Touch drop
elementsLayer.addEventListener("touchend", e=>{
  if(!draggingId) return;
  const rect = elementsLayer.getBoundingClientRect();
  const touch = e.changedTouches[0];
  spawnElement(draggingId, touch.clientX - rect.left - 50, touch.clientY - rect.top - 50);
  draggingId = null;
});

// Dragging behavior
function makeDraggable(el){
  let offsetX, offsetY;

  function onMouseDown(e){
    if (e.target.classList.contains("resize-handle")) return;

    offsetX = e.clientX - el.offsetLeft;
    offsetY = e.clientY - el.offsetTop;

    document.addEventListener("mousemove", onMouseMove);
    document.addEventListener("mouseup", onMouseUp);
  }

  function onMouseMove(e){
    el.style.left = e.clientX - offsetX + "px";
    el.style.top = e.clientY - offsetY + "px";
  }

  function onMouseUp(){
    document.removeEventListener("mousemove", onMouseMove);
    document.removeEventListener("mouseup", onMouseUp);
  }

  el.addEventListener("mousedown", onMouseDown);

  // Touch drag
  el.addEventListener("touchstart", e=>{
    const t = e.touches[0];
    offsetX = t.clientX - el.offsetLeft;
    offsetY = t.clientY - el.offsetTop;
  });

  el.addEventListener("touchmove", e=>{
    const t = e.touches[0];
    el.style.left = t.clientX - offsetX + "px";
    el.style.top = t.clientY - offsetY + "px";
  });
}

// Resizing
function makeResizable(el, handle){
  let startX, startY, startW, startH;

  handle.addEventListener("mousedown", e=>{
    e.stopPropagation();
    startX = e.clientX;
    startY = e.clientY;
    startW = parseInt(getComputedStyle(el).width);
    startH = parseInt(getComputedStyle(el).height);

    document.addEventListener("mousemove", resize);
    document.addEventListener("mouseup", stop);
  });

  function resize(e){
    el.style.width = startW + (e.clientX - startX) + "px";
    el.style.height = startH + (e.clientY - startY) + "px";
  }

  function stop(){
    document.removeEventListener("mousemove", resize);
    document.removeEventListener("mouseup", stop);
  }

  // Touch resize
  handle.addEventListener("touchstart", e=>{
    const t = e.touches[0];
    startX = t.clientX;
    startY = t.clientY;
    startW = parseInt(getComputedStyle(el).width);
    startH = parseInt(getComputedStyle(el).height);
  });

  handle.addEventListener("touchmove", e=>{
    const t = e.touches[0];
    el.style.width = startW + (t.clientX - startX) + "px";
    el.style.height = startH + (t.clientY - startY) + "px";
  });
}
</script>

</body>
</html>
