<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Media Pembelajaran Interaktif</title>

  <style>
    :root{
      --primary:#2a4d8f;
      --accent:#4a90e2;
      --bg1:#e3f2fd;
      --bg2:#f3f5f7;
      --card:#ffffff;
      --shadow:0 6px 18px rgba(38,72,126,0.08);
      font-family:"Poppins",system-ui;
    }

    html,body{margin:0;padding:0;height:100%;background:linear-gradient(135deg,var(--bg1),var(--bg2));}

    .app{
      display:flex;
      flex-direction:column;
      min-height:100vh;
      padding:24px;
      box-sizing:border-box;
    }

    .container{max-width:1100px;margin:auto;width:100%}

    .page{display:none}
    .active{display:block}

    .menu-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:24px;margin-top:24px;}

    .menu-item{
      background:var(--card);
      padding:20px;
      border-radius:18px;
      text-align:center;
      cursor:pointer;
      box-shadow:var(--shadow);
      transition:.2s;
      color:var(--primary);
      pointer-events:auto;
    }
    .menu-item:hover{background:var(--accent);color:white;transform:translateY(-6px);}
    .menu-item img{width:70px;height:70px;object-fit:contain;pointer-events:none;}

    .viewer{
      width:100%;height:600px;background:black;border-radius:12px;overflow:hidden;
    }

    iframe{width:100%;height:100%;border:0;}

    .btn{
      background:var(--accent);color:white;padding:10px 16px;border:none;
      border-radius:8px;cursor:pointer;margin:3px;
    }
    .btn.ghost{background:transparent;border:1px solid #bbb;color:var(--primary);}

    /* interactive */
    #canvasWrapper{display:flex;gap:16px;flex-wrap:wrap;justify-content:center}
    #canvas{
      position:relative;width:60%;min-width:300px;height:480px;background:#fff;border-radius:12px;
      border:2px solid #ddd;overflow:hidden;pointer-events:auto;
    }

    #drawCanvas{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:auto}
    #elements-layer{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:auto}
    #petunjuk{position:absolute;top:45%;left:50%;transform:translate(-50%,-50%);color:#777;}

    #canvasKunci{
      width:35%;min-width:200px;display:none;border:2px dashed #aaa;padding:8px;border-radius:10px;
      text-align:center;background:#fafafa;
    }
    #canvasKunci img{width:100%;border-radius:10px;}

    .elemen{
      width:80px;height:80px;border:2px solid #ccc;border-radius:8px;background:#fff;
      display:flex;justify-content:center;align-items:center;cursor:pointer;pointer-events:auto;
    }
    .elemen img{width:100%;height:100%;object-fit:contain;pointer-events:none;}

    .resizable{
      position:absolute;border:1px dashed #aaa;border-radius:6px;cursor:grab;touch-action:none;
      pointer-events:auto;
    }
    .resizable img{width:100%;height:100%;object-fit:contain;pointer-events:none;}

    .resize-handle{
      position:absolute;width:14px;height:14px;background:var(--accent);
      border-radius:50%;bottom:0;right:0;cursor:se-resize;
    }

    @media(max-width:720px){
      #canvas{height:320px;}
      .viewer{height:320px;}
    }

    .video-scroll{
      display:flex;gap:20px;overflow-x:auto;padding-bottom:10px;scroll-snap-type:x mandatory;
    }
    .video-scroll iframe{
      width:320px;height:180px;flex-shrink:0;border-radius:12px;background:#000;scroll-snap-align:start;
    }
  </style>
</head>

<body>

  <button id="globalBack" class="btn" style="position:fixed;top:16px;left:16px;display:none;z-index:999;">
    ⬅️
  </button>

  <div class="app">
    <div class="container">

      <!-- DASHBOARD -->
      <section id="dashboard" class="page active">
        <h1>Media Pembelajaran Interaktif</h1>
        <div class="menu-grid">
          <div class="menu-item" data-target="materi"><img src="assets/icon-materi.png"><br>Materi</div>
          <div class="menu-item" data-target="modul"><img src="assets/icon-modul.png"><br>Modul</div>
          <div class="menu-item" data-target="video"><img src="assets/icon-video.png"><br>Video</div>
          <div class="menu-item" data-target="interaktif"><img src="assets/icon-interaktif.png"><br>Media Interaktif</div>
        </div>
      </section>

      <!-- MATERI -->
      <section id="materi" class="page">
        <h2>Materi</h2>
        <div class="viewer"><iframe src="assets/slide.html"></iframe></div>
        <button class="btn ghost" onclick="showSection('dashboard')">Kembali</button>
      </section>

      <!-- MODUL -->
      <section id="modul" class="page">
        <h2>Modul</h2>
        <div class="viewer"><iframe src="assets/modul.pdf"></iframe></div>
        <button class="btn ghost" onclick="showSection('dashboard')">Kembali</button>
      </section>

      <!-- VIDEO -->
      <section id="video" class="page">
        <h2>Video Pembelajaran</h2>
        <div class="video-scroll">
          <iframe src="https://www.youtube.com/embed/ASBNa7b-7MQ"></iframe>
          <iframe src="https://www.youtube.com/embed/aON_if40J_8"></iframe>
          <iframe src="https://www.youtube.com/embed/SJ739--Vc3A"></iframe>
        </div>
        <button class="btn ghost" onclick="showSection('dashboard')">Kembali</button>
      </section>

      <!-- INTERAKTIF -->
      <section id="interaktif" class="page">
        <h2>Media Interaktif: Merangkai Elemen</h2>

        <div id="canvasWrapper">
          <div id="canvas">
            <canvas id="drawCanvas"></canvas>
            <div id="elements-layer"></div>
            <div id="petunjuk">Drag titik ke area ini</div>
          </div>

          <div id="canvasKunci">
            <h3>Kunci Jawaban</h3>
            <img src="assets/kunciJawaban.png">
          </div>
        </div>

        <br>
        <div style="text-align:center">
          <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
            <div class="elemen"><img src="assets/titikA.png"></div>
            <div class="elemen"><img src="assets/titikB.png"></div>
            <div class="elemen"><img src="assets/titikC.png"></div>
            <div class="elemen"><img src="assets/titikD.png"></div>
            <div class="elemen"><img src="assets/titikE.png"></div>
          </div>

          <br>
          <button class="btn" id="modeDraw">Mode Gambar</button>
          <button class="btn" id="modeClick">Mode Klik</button>
          <button class="btn" id="undo">Undo</button>
          <button class="btn ghost" id="toggleKunci">Kunci Jawaban</button>
          <button class="btn ghost" onclick="showSection('dashboard')">Kembali</button>
        </div>
      </section>

    </div>
  </div>

<script>
const pages=document.querySelectorAll('.page');
const menuItems=document.querySelectorAll('.menu-item');
const globalBack=document.getElementById('globalBack');

function showSection(id){
  pages.forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  globalBack.style.display=id==='dashboard'?'none':'block';
  if(id==="interaktif") initMedia();
}

menuItems.forEach(m=>{
  m.onclick=()=>showSection(m.dataset.target);
});
globalBack.onclick=()=>showSection('dashboard');

// prevent save popup hanya pada elemen interaktif
document.addEventListener("contextmenu", e=>{
  if(e.target.closest(".resizable") || e.target.closest(".elemen")){
    e.preventDefault();
  }
});

let mediaInit=false;

function initMedia(){
  if(mediaInit)return;
  mediaInit=true;

  const canvas=document.getElementById("canvas");
  const drawCanvas=document.getElementById("drawCanvas");
  const ctx=drawCanvas.getContext("2d");
  const layer=document.getElementById("elements-layer");
  const petunjuk=document.getElementById("petunjuk");
  const kunci=document.getElementById("canvasKunci");
  let lines=[],mode="draw",temp=null;
  let drawing=false,sx,sy;

  function resize(){
    const r=canvas.getBoundingClientRect();
    drawCanvas.width=r.width;
    drawCanvas.height=r.height;
    redraw();
  }
  window.addEventListener("resize",resize);setTimeout(resize,100);

  function redraw(){
    ctx.clearRect(0,0,drawCanvas.width,drawCanvas.height);
    ctx.strokeStyle="#2a4d8f";ctx.lineWidth=3;
    lines.forEach(l=>{
      ctx.beginPath();ctx.moveTo(l.x1,l.y1);ctx.lineTo(l.x2,l.y2);ctx.stroke();
    });
  }

  document.getElementById("modeDraw").onclick=()=>{mode="draw";temp=null;}
  document.getElementById("modeClick").onclick=()=>{mode="click";temp=null;}
  document.getElementById("undo").onclick=()=>{lines.pop();redraw();}
  document.getElementById("toggleKunci").onclick=()=>{kunci.style.display=kunci.style.display==="none"?"block":"none";}

  // DRAW — mouse
  drawCanvas.onmousedown=e=>{
    if(mode!=="draw")return;
    drawing=true;
    const r=drawCanvas.getBoundingClientRect();
    sx=e.clientX-r.left;sy=e.clientY-r.top;
  };
  drawCanvas.onmousemove=e=>{
    if(!drawing)return;
    const r=drawCanvas.getBoundingClientRect();
    const x=e.clientX-r.left,y=e.clientY-r.top;
    redraw();ctx.beginPath();ctx.moveTo(sx,sy);ctx.lineTo(x,y);ctx.stroke();
  };
  drawCanvas.onmouseup=e=>{
    if(!drawing)return;
    drawing=false;
    const r=drawCanvas.getBoundingClientRect();
    lines.push({x1:sx,y1:sy,x2:e.clientX-r.left,y2:e.clientY-r.top});
    redraw();
  };

  // CLICK mode
  drawCanvas.onclick=e=>{
    if(mode!=="click")return;
    const r=drawCanvas.getBoundingClientRect();
    const x=e.clientX-r.left,y=e.clientY-r.top;
    if(!temp){
      temp={x,y};
      ctx.beginPath();ctx.arc(x,y,5,0,Math.PI*2);ctx.fillStyle="red";ctx.fill();
    }else{
      lines.push({x1:temp.x,y1:temp.y,x2:x,y2:y});
      temp=null;redraw();
    }
  };

  // DRAG titik
  document.querySelectorAll(".elemen").forEach(source=>{
    source.addEventListener("pointerdown",e=>{
      if(petunjuk)petunjuk.style.display="none";
      const r=layer.getBoundingClientRect();
      const clone=document.createElement("div");
      clone.className="resizable";
      clone.style.left=(e.clientX-r.left-40)+"px";
      clone.style.top=(e.clientY-r.top-40)+"px";
      clone.style.width="80px";clone.style.height="80px";
      const im=document.createElement("img");
      im.src=source.querySelector("img").src;
      clone.appendChild(im);
      const h=document.createElement("div");
      h.className="resize-handle";
      clone.appendChild(h);
      layer.appendChild(clone);
      makeDraggable(clone);
      makeResizable(clone,h);
    });
  });

  function makeDraggable(el){
    let drag=false,ox,oy;
    el.addEventListener("pointerdown",e=>{
      drag=true;
      const r=layer.getBoundingClientRect();
      ox=e.clientX-r.left-el.offsetLeft;
      oy=e.clientY-r.top-el.offsetTop;
      el.setPointerCapture(e.pointerId);
    });
    el.addEventListener("pointermove",e=>{
      if(!drag)return;
      const r=layer.getBoundingClientRect();
      let x=e.clientX-r.left-ox;
      let y=e.clientY-r.top-oy;
      x=Math.max(0,Math.min(x,layer.clientWidth-el.offsetWidth));
      y=Math.max(0,Math.min(y,layer.clientHeight-el.offsetHeight));
      el.style.left=x+"px";el.style.top=y+"px";
    });
    el.addEventListener("pointerup",()=>drag=false);
  }

  function makeResizable(el,h){
    let rs=false,sx,sy,sw,sh;
    h.addEventListener("pointerdown",e=>{
      rs=true;sx=e.clientX;sy=e.clientY;
      sw=parseInt(el.style.width);sh=parseInt(el.style.height);
      e.stopPropagation();
      el.setPointerCapture(e.pointerId);
    });
    el.addEventListener("pointermove",e=>{
      if(!rs)return;
      el.style.width=Math.max(60,sw+(e.clientX-sx))+"px";
      el.style.height=Math.max(60,sh+(e.clientY-sy))+"px";
    });
    el.addEventListener("pointerup",()=>rs=false);
  }
}
</script>

</body>
</html>
